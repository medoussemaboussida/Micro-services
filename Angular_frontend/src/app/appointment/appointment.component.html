<!-- src/app/appointment/appointment.component.html -->
<div class="container">
    <h2>Gestion des Rendez-vous</h2>
  
    <!-- Messages -->
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
    <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>
  
    <!-- Formulaire pour ajouter un rendez-vous -->
    <form (ngSubmit)="addAppointment()">
      <h3>Ajouter un Rendez-vous</h3>
      <div>
        <label for="student">Nom de l'étudiant :</label>
        <input id="student" [(ngModel)]="newAppointment.student" name="student" placeholder="Nom de l'étudiant" required>
      </div>
      <div>
        <label for="psychiatrist">Psychiatre :</label>
        <input id="psychiatrist" [(ngModel)]="newAppointment.psychiatrist" name="psychiatrist" placeholder="Nom du psychiatre" required>
      </div>
      <div>
        <label for="date">Date :</label>
        <input id="date" type="date" [(ngModel)]="newAppointment.date" name="date" required>
      </div>
      <div>
        <label for="startTime">Heure de début :</label>
        <input id="startTime" type="time" [(ngModel)]="newAppointment.startTime" name="startTime" required>
      </div>
      <div>
        <label for="endTime">Heure de fin :</label>
        <input id="endTime" type="time" [(ngModel)]="newAppointment.endTime" name="endTime" required>
      </div>
      <button type="submit">Ajouter</button>
    </form>
  
    <!-- Formulaire pour modifier un rendez-vous -->
    <form *ngIf="editAppointment" (ngSubmit)="updateAppointment()">
      <h3>Modifier le Rendez-vous</h3>
      <div>
        <label for="edit-student">Nom de l'étudiant :</label>
        <input id="edit-student" [(ngModel)]="editAppointment.student" name="edit-student" required>
      </div>
      <div>
        <label for="edit-psychiatrist">Psychiatre :</label>
        <input id="edit-psychiatrist" [(ngModel)]="editAppointment.psychiatrist" name="edit-psychiatrist" required>
      </div>
      <div>
        <label for="edit-date">Date :</label>
        <input id="edit-date" type="date" [(ngModel)]="editAppointment.date" name="edit-date" required>
      </div>
      <div>
        <label for="edit-startTime">Heure de début :</label>
        <input id="edit-startTime" type="time" [(ngModel)]="editAppointment.startTime" name="edit-startTime" required>
      </div>
      <div>
        <label for="edit-endTime">Heure de fin :</label>
        <input id="edit-endTime" type="time" [(ngModel)]="editAppointment.endTime" name="edit-endTime" required>
      </div>
      <button type="submit">Mettre à jour</button>
      <button type="button" (click)="cancelEdit()">Annuler</button>
    </form>
  
    <!-- Recherche par psychiatre -->
    <div class="search-section">
      <label for="search-psychiatrist">Rechercher par psychiatre :</label>
      <input id="search-psychiatrist" [(ngModel)]="searchPsychiatrist" (input)="searchByPsychiatrist()" placeholder="Entrez le nom du psychiatre">
    </div>
  
    <!-- Boutons de tri et exportation -->
    <div class="action-buttons">
      <button (click)="exportToPDF()" class="export-button">Exporter en PDF</button>
      <button (click)="exportToCSV()" class="export-button">Exporter en CSV</button> <!-- Bouton ajouté -->
      <button (click)="changeSortOrder('recent')" [class.active]="sortOrder === 'recent'">Plus récent d'abord</button>
      <button (click)="changeSortOrder('old')" [class.active]="sortOrder === 'old'">Plus ancien d'abord</button>
    </div>
  
    <!-- Tableau des rendez-vous -->
    <table *ngIf="appointments.length > 0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nom de l'étudiant</th>
          <th>Psychiatre</th>
          <th>Date</th>
          <th>Heure de début</th>
          <th>Heure de fin</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let appointment of appointments">
          <td>{{ appointment.id }}</td>
          <td>{{ appointment.student }}</td>
          <td>{{ appointment.psychiatrist }}</td>
          <td>{{ appointment.date | date:'mediumDate' }}</td>
          <td>{{ appointment.startTime }}</td>
          <td>{{ appointment.endTime }}</td>
          <td>
            <select [(ngModel)]="appointment.status" (change)="updateStatus(appointment, appointment.status)">
              <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
            </select>
          </td>
          <td>
            <button (click)="startEdit(appointment)">Modifier</button>
            <button (click)="deleteAppointment(appointment.id)">Supprimer</button>
          </td>
        </tr>
      </tbody>
    </table>
    <p *ngIf="appointments.length === 0">Aucun rendez-vous trouvé.</p>
  </div>